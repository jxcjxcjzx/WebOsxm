 博客首页登录注册冬天就要这么玩 发博文  博文        ×推荐：2012博客年终盘点最小清新年度热图盘点
推荐：2012博客年终盘点最小清新年度热图盘点y_qiwei的博客
http://blog.sina.com.cn/u/2457041971 [订阅][手机订阅]首页 博文目录 图片 关于我个人资料 
 编程初学者 
Qing 微博 
加好友 发纸条 

写留言 加关注 


博客等级： 博客积分：58 博客访问：1,404 关注人气：1 
精彩图文 
你所不知道的接吻的秘密
巨星们的裤子

新浪Qing

手心中精彩世界

新浪Qing

前苏联选美大赛

新浪Qing

面码各式表情图

新浪Qing

比肉好吃的素菜

新浪Qing

巧克力的诱惑

新浪Qing


查看更多>>
相关博文 
每个吃货都空有一颗减肥的心
ME不是白富美
四大美女之一【貂蝉】的真实模样
微三国
徐小明：反击，以后请别来惹我
徐小明
暴力
wu2198
22条很有趣的夫妻经典定律
雨中竹
南方周末新年献辞事件的重大意
李银河
毛泽东孙子毛新宇题字大全（图
思考者
你害怕了吗？
情感威客
管理日志14：想人所想，先人
张杨Alex
更多>>
推荐博文 
郎遥远：中科院的“自淫”报告
郎遥远
第九百一十五篇•老子
马未都
浅谈小主一词
橘玄雅
袁厉害涉嫌过失致人死亡罪吗？
丁金坤
“抢流浪者棉衣”暴露公权怪脾气
李松林的博客
《一代宗师》：久别重逢王家卫
藤井树小姐
“九成公务员出身平民”是障眼法
李慧翔
来美生子须知，千万别拿美国法律
加州姐姐
小镇上4
揣摩
电影报道：章子怡疑因撒贝宁放弃
中国电影报道


林海雪原


比基尼长腿美女弄潮


德国的冬天处处是感动


25道经典鸡肉菜做法


简单有面子的春节大菜


寒冬蓝天下的枯树枝

查看更多>>
谁看过这篇博文 
加载中…
正文 字体大小：大 中 小 
Yacc使用(2012-02-18 16:30:11)转载▼标签： 杂谈  
 
 
1.概念
yacc使用巴克斯范式（BNF）定义语法，能处理上下文无关文法（context-free）。

出现在每个产生式左边（left-hand side：lhs）的符号是非终端符号，出现在产生式右边（right-hand side：rhs）的符号有非终端符号和终端符号，但终端符号只出现在右端。


在规约过程中可能会有冲突。Yacc对此有一些缺省的处理方法，那就是使用第一个匹配的规则。



--------------------------------------------------------------------------------

2.Yacc文件格式
Yacc文件分为三部分：
... definitions ...
%%
... rules ...
%%
... subroutines ...

--------------------------------------------------------------------------------

3.定义部分
第一部分包括标志（token）定义和C代码（用“%{”和“%}”括起来）。

如在定义部分定义标志：
%token INTEGER


当运行yacc后，会产生头文件，里面包含该标志的预定义，如：
#ifndef YYSTYPE
#define YYSTYPE int
#endif
#define INTEGER 258
extern YYSTYPE yylval;


lex使用该头文件中的标志定义。Yacc调用lex的yylex()来获得标志（token），与标志对应的值由lex放在变量yylval中。yylval的类型由YYSTYPE决定，YYSTYPE缺省类型是int。如：
[0-9]+ {
yylval = atoi(yytext);
return INTEGER;
}


标志0-255被保留作为字符值，一般产生的token标志从258开始。如：
[-+] return *yytext;
返回加号或减号。注意要把减号放在前面，避免被认作是范围符号。


对于操作符，可以定义%left和%right：%left表示左相关（left-associative），%right表示右相关（right-associative）。可以定义多组%left或%right，在后面定义的组有更高的优先级。如：
%left ‘+’ ‘-‘
%left ‘*’ ‘/’
上面定义的乘法和除法比加法和减法有更高的优先级。


Yacc内部维持着两个栈：符号栈（parse stack）和值栈（value stack），这两个栈始终是同步的。


改变YYSTYPE的类型。如这样定义TTSTYPE：
%union {
int iValue;
char sIndex;
nodeType *nPtr;
};
则生成的头文件中的内容是：
typedef union {
int iValue;
char sIndex;
nodeType *nPtr;
} YYSTYPE;
extern YYSTYPE yylval;


可以把标志（token）绑定到YYSTYPE的某个域。如：
%token INTEGER
%type expr
把expr绑定到nPtr，把INTEGER绑定到iValue。yacc处理时会做转换。如：
expr: INTEGER { $$ = con($1); }
转换结果为：
yylval.nPtr = con(yyvsp[0].iValue);
其中yyvsp[0]是值栈（value stack）当前的头部。


定义一元减号符有更高的优先级的方法：
%left GE LE EQ NE '>' '<'
%left '+' '-'
%left '*'
%nonassoc UMINUS
%nonassoc的含义是没有结合性。它一般与%prec结合使用表示该操作有同样的优先级。如：
expr: '-' expr %prec UMINUS { $$ = node(UMINUS, 1, $2); }
表示该操作的优先级与UMINUS相同，在上面的定义中，UMINUS的优先级高于其他操作符，所以该操作的优先级也高于其他操作符计算。



--------------------------------------------------------------------------------

4.规则部分
规则部分很象BNF语法。

规则中目标或非终端符放在左边，后跟一个冒号（：），然后是产生式的右边，之后是对应的动作（用{}包含）。如：
%token INTEGER
%%
program: program expr '\n' { printf("%d\n", $2); }
|
;
expr: INTEGER { $$ = $1; }
| expr '+' expr { $$ = $1 + $3; }
| expr '-' expr { $$ = $1 - $3; }
;
%%
int yyerror(char *s)
{
fprintf(stderr, "%s\n", s);
return 0;
}
int main(void)
{
yyparse();
return 0;
}


其中，$1表示右边的第一个标记的值，$2表示右边的第二个标记的值，依次类推。$$表示规约后的值。



--------------------------------------------------------------------------------

5.第三部分
该部分是函数部分。当yacc解析出错时，会调用函数yyerror()，用户可自定义函数的实现。main函数是调用yacc解析入口函数yyparse()。

--------------------------------------------------------------------------------

6.递归的处理
递归处理有左递归和右递归。

左递归形式：
list:
item
| list ',' item ;


右递归形式：
list: item
| item ',' list


使用右递归时，所有的项都压入堆栈里，才开始规约；而使用左递归的话，同一时刻不会有超过三个项在堆栈里。


所以，使用左递归有很大的优势。



--------------------------------------------------------------------------------

7.If-Else的冲突
当有两个IF一个ELSE时，该ELSE和哪个IF匹配是一个问题。有两中匹配方法：与第一个匹配和与第二匹配。现代程序语言都让ELSE与最近的IF匹配，这也是yacc的缺省行为。

虽然yacc行为正确，但为避免警告，可以给IF-ELSE语句比IF语句更高的优先级：
%nonassoc IFX
%nonassoc ELSE
stmt: IF expr stmt %prec IFX
| IF expr stmt ELSE stmt



--------------------------------------------------------------------------------

8.出错处理
当yacc解析出错时，缺省的行为是调用函数yyerror()，然后从yylex返回一个值。一个更友好的方法是忽略一段错误输入流，继续开始扫描。实现方法如下：

stmt:
';'
| expr ';'
| PRINT expr ';'
| VARIABLE '=' expr ';
| WHILE '(' expr ')' stmt
| IF '(' expr ')' stmt %prec IFX
| IF '(' expr ')' stmt ELSE stmt
| '{' stmt_list '}'
| error ';'
| error '}'
;


这里的error标志表示，当yacc发现错误时，它调用yyerror()，之后是输入流往前到‘；’或‘}’，然后继续扫描。



--------------------------------------------------------------------------------

9.Yacc源程序的风格
建议按照如下风格来写：
（1）终端符名全部用大写字母，非终端符全部用小写字母；
（2）把语法规则和语义动作放在不同的行；
（3）把左部相同的规则写在一起，左部只写一次，而后面所有规则都写在竖线“|”之后；
（4）把分号“；”放在规则最后，独占一行；
（5）用制表符来对齐规则和动作。 

分享： 分享到新浪Qing 0
喜欢

阅读(669)┊ 评论 (0)┊ 收藏(1) ┊转载(0) ┊ 喜欢▼ ┊打印┊举报 已投稿到：  排行榜 圈子  

转载列表：
转载 
转载是分享博文的一种常用方式...

前一篇：程序代码阅读技巧后一篇：FIRST和FOLLOW集求法评论 重要提示：警惕虚假中奖信息|[商讯]我有明星气势签名[发评论]评论加载中，请稍候...

发评论 [商讯]爱心签名换梦想，天天派奖|[商讯]提高博客人气新方法
  更多>>

登录名： 密码： 找回密码 注册 记住登录状态
昵   称：

 分享到微博    评论并转载此博文

验证码： 请点击后输入验证码 收听验证码 
匿名评论发评论 
以上网友发言只代表其个人观点，不代表新浪网的观点或立场。
< 前一篇
程序代码阅读技巧后一篇 >
FIRST和FOLLOW集求法
  新浪BLOG意见反馈留言板　不良信息反馈　电话：4006900000 提示音后按1键（按当地市话标准计费）　欢迎批评指正

新浪简介 | About Sina | 广告服务 | 联系我们 | 招聘信息 | 网站律师 | SINA English | 会员注册 | 产品答疑 

Copyright © 1996 - 2013 SINA Corporation, All Rights Reserved

新浪公司 版权所有


X分享到...选择其他平台 >>
365
长微博
微语录
九宫格
发照片
发视频
发商品
博文博主音乐视频播主 分享到X
腾讯微博一键通新浪微博QQ空间人人网天涯凤凰微博朋友网人民微博豆瓣网搜狐微博新华微博手机网易微博开心网百度空间QQ好友更多平台... (130)bShare最近喜欢了的博主：
加载中…Qing博客转载原文采编长微博分享到新浪Qing分享到新浪微博为了您的账号安全，请绑定邮箱
幻灯播放




关闭
