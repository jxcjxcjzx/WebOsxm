分享到QQ空间新浪微博百度搜藏人人网腾讯微博开心网腾讯朋友百度空间豆瓣网搜狐微博百度新首页QQ收藏和讯微博我的淘宝百度贴吧更多...百度分享
首页我的主页相册广场消息 私信(1) 模板 设置 退出 关注此空间Den of 必记未读
The host of this den is incredibly lazy. He leaves nothing interesting.
2007-12-20 21:47 Linux C编程——IPC：共享内存共享内存（Shared Memory）是最简单的进程间通信方式，它允许多个进程访问相同的内存，一个进程改变其中的数据后，其他的进程都可以看到数据的变化。

共享内存是进程间最快速的通信方式：
｀进程共享同一块内存空间。
｀访问共享内存和访问私有内存一样快。
｀不需要系统调用和内核入口。
｀不造成不必要的内存复制。

内核不对共享内存的访问进行同步，因此程序员必须自己提供同步。

使用共享内存：
｀某个进程分配内存段。
｀使用这个内存段的进程要连接（attach）这个内存段。
｀每个进程使用完共享内存段后，要分离（detach）这个内存段。
｀在某个地方，必须有一个进程来销毁这个内存段。

Linux的内存模型：
｀每个进程的虚拟内存被分为页（page）。
｀每个进程维护自己的内存地址到虚拟内存页之间的映射。
｀实际的数据存在于进程的内存地址上。
｀尽管每个进程有自己的地址空间，多个进程的映射还是可以指向相同的页。

所有的共享内存段的大小，都是Linux内存页大小的整数倍。
Linux的页大小是4KB，不过程序员应该使用getpagesize函数来获得这个值。

分配：shmget
｀第一个参数是一个整型的键，用于指定要创建的段。无关的进程可以通过指定同一个键来访问同一段共享内存。
｀使用常量IPC_PRIVATE作为第一个参数，可以避免键的冲突。
｀第二个参数是分配的段的大小（字节数）。实际分配的字节数会舍弃多余部分到页大小的整数倍。
｀第三个参数是位标志，用来表示创建的选项。
｀｀IPC_CREATE：表明要创建新的共享内存空间。
｀｀IPC_EXCL：总是和上一个标志一起使用。如果指定键的共享内存段已经存在，这个标志会导致调用失败；如果没有指定这个标志，调用会返回已经占用这个键的共享内存段。
｀｀模式标志：9个bit的标志，和系统的文件权限使用相同的标志，不过执行标志无效。这些标志定义在<sys/stat.h>中。
｀返回值是新创建的或者取得的内存段的标志符（SHMID）。

连接：shmat
｀第一个参数是由shmget得到的标志符（SHMID）。
｀第二个参数是指向你想要映射到的本进程的地址空间的指针。如果指定NULL，Linux负责选择一个可用的地址。
#C 分享到： 举报 浏览(8694) 评论(1) 转载 
你可能也喜欢
 海贼王  星野发布的图片  【动漫】桌面壁纸~【大图】  「Dragon Ball」龙珠美女图  《穿越时空的少女》---我在未来等你  恋爱随意链接——观后感  Linux C编程——线程的使用 本文最近访客
 chary8088 1月10日评论

 同时评论给  
 同时评论给原文作者   发布 500/0
许亚中厉害！ 2008-11-01 13:09回复
收起|查看更多
帮助中心 | 空间客服 | 投诉中心 | 空间协议©2013 Baiduabcdef
