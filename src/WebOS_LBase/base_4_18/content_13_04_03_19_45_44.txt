德问，最纯粹的编程社交问答
帮您解答各类编程问题，交流与扩展专业知识及技能。

德问

首 页
待解决
1浏 览 
登 录
C
C语言中的const实现机制
Eclipse
3 票
 1877
一直很好奇const int a是如何做到让变量a只读的呢？

评论 (0) • 分享 • 链接 • 2011-11-13　
7个答案 票 数  
黄文彬
3 票
6072
const类型的和没有声明为const类型的编译后的结果是相同的。可以看下const char *a="111";和char *a="111";在反汇编代码中是一样的，都是如下结果：

 图片加载...




但如下代码：
const char *a="111";
*a="222";

编译器会报错:
error C2440: '=' : cannot convert from 'char [4]' to 'const char' This conversion requires a reinterpret_cast, a C-style cast or function-style cast

所以只是编译器编译时进行了限制。

评论 (2) • 链接 • 2011-11-13
0
呵呵，那编译器又是如何限制的呢~ – Eclipse 2011-11-13
0
编译器通过“词法分析”、“语意分析”限制的，修改Const变量这个地址，不让编译通过，呵呵。 – 黄文彬 2011-11-13
李剑波
3 票
4748
const修饰属于编译层面的限制。一般不会涉及到运行层面。
但是对于c/c++程序员来讲，最重要在于理解const是用来做接口设计的，
正确使用const可以明确传递给调用者或维护者信息，告诉他们这个变量和
函数是不能修改，否则就是违背设计的初衷。通过编译层面的防错来构建
设计的约束这才是const的用处。

补充：
如果你用memset去修改所谓const变量的内容，发现没有任何问题，结合上面所述就能
明白const到底是做什么的。

评论 (0) • 链接 • 2011-11-14
唐仕强
4 票
4764
编译的时候，编译器进行语法检查可以发现变量的使用是否出现违反const的情况。出错就会报错。
在链接成DLL或者EXE后，也有可能让变量是只读的。在PE的标准中，有一个section，通常的名称是.rdata，这个节内的数据就是只读数据。在运行的时候这块内存设置成只读，不能写，就达到了const的要求
评论 (1) • 链接 • 2011-11-16
0
说得很好，就是“全局变量”都保存在.rdata段里了，只读或不只读。只读只是编译器玩得把戏。 – 黄文彬 2011-11-16
李健
1 票
711
const修饰只在编译层，代码中违反const的行为被禁止。但const变量的存储跟普通存储并没用区别，是可以修改const值的。

评论 (0) • 链接 • 2011-11-14
ruibinlin
1 票
21
const 修饰的变量和不带const修饰的变量主要是存储的位置不同，const是在只读区中，而不带const 是放在普通的内存中。

评论 (0) • 链接 • 2012-07-27
马瑜
0 票
6050
编译器直接把变量a替换成常量了

评论 (0) • 链接 • 2011-11-13
magic
0 票
1553
1 const是语法保留字，是编译器或解释器处理的，代码中违反const的行为会被它们禁止（报错）；
2 编译器会把const修饰的变量放在系统的不可修改的存储位置吧，这个可由OS来加以限制（底层方面了解不多）。

评论 (1) • 链接 • 2011-11-14
0
字符串字面值都是不可修改的；
整型的话，全局变量带const在.rodata里，不带则在.data中；局部变量带不带const都是栈中，只能通过编译器限制。 – magic 2011-11-14
不是您所需，查看更多相关问题与答案
const c语言, delphi程式入口函数, reinterpret_cast, const char a[], 在const 被改变
德问是一个专业的编程问答社区，请 登录 或 注册 后再提交答案
相关问题
关于Automatic Reference Counting技术的深度解释？
内存回收机制的问题
弱类型语言与强类型语言的区别
选择编程语言
为什么C语言写的程序(库,接口)那么难以阅读？
编程语言中对string的设计
go 语言在windows环境下不能正确显示中文
为什么编程语言的变量名不能以数字开头？
听说有一种程序设计语言是纯01代码设计的，　不知道是什么语言（非编码生成的机器语言）
会基础C/C++语言想学习移动开发，请指导一下学习路线！
关注该问题的人 （8人）

问题状态
最近活动:2012-07-27
共被浏览 (1646) 次
关于
关于德问
社区指南
官方博客
指导方针
好问题的重要性
提好的主观问题
善用您的投票权
协议
服务条款
隐私协议
WiKi协作与CC版权
其他
黑客与画家
官方微博  
德问QQ群
友情链接
程序员
结构之法 算法之道

本站所有协作内容均采用CC-BY-SA 3.0协议（署名-相同方式共享）进行许可。
京ICP备09007496号-9
返回顶部
相关推荐社区热门
• 如何才能在改变声明为const的类中的成员函数中的..2011-11-11
• const char* 和const char [..2012-03-08
• c++中const和指针疑问2012-03-13
• C++中const内存分配2012-09-19
• trivial constructor的作用2012-09-26
+ 更多"c const 实现"相关精品问答
当前有100位技术同行在线。   快速提问
