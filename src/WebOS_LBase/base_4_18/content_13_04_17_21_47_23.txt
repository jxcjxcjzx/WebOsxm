下载2频道 我的主页帐号设置退出秀才　二级|消息 私信通知|我的百科我的贡献草稿箱我的任务为我推荐|百度首页 新闻网页贴吧知道音乐图片视频地图百科文库
    帮助 首页 自然 文化 地理 历史 生活 社会 艺术 人物 经济 科技 体育 图片 数字博物馆 核心用户 百科商城 禽流感究竟多危险
生成树
求助编辑百科名片
生成树即生成树协议——STP(SpanningTreepProtocol)能够提供路径冗余，使用STP可以使两个终端中只有一条有效路径。STP在大的网络中定义了一个树，并且迫使一定的备份路径处于备用状态。如果生成树中的网络一部分不可达，或者STP值变化了，生成树算法会重新计算生成树拓扑，并且通过启动备份路径来重新建立连接。

目录

作用
工作原理
状态
数据结构
生成树根的选举
简介
STP操作对于终端来说是透明的，而不管终端连在LAN的某一部分或者多个部分。当创建网络时，网络中所有节点存在多条路径。生成树中的算法计算出最佳路径。因为每个VLAN是一个逻辑LAN部分，所以网管员能使STP一次工作在最多64个VLAN中。如果要配置超过64个VLAN，网管员需要将其他VLAN的STP禁止，因为默认的STP可以支持1-64个VLAN。
编辑本段作用在实际的网络环境中，物理环路可以提高网络的可靠性，当一条物理线路断掉的时候，另外一条线路仍然可以传输数据。但是，在交换的网络中，当交换机接收到一个目的地址未知的数据帧时，交换机会将这个数据帧广播出去，这样，在存在物理环路的交换网络中，就会产生双向的广播环，甚至产生广播风暴，导致交换机资源耗尽而宕机。这样就产生了一个矛盾，需要物理环路来提高网络的可靠性，而环路又有可能产生广播风暴，怎样才能两全其美呢？ STP（Spanning Tree Protocol，生成树协议），就是用来解决这个矛盾的。STP协议在逻辑上断开网络的环路，防止广播风暴产生，而一旦正在使用的线路出现故障，被逻辑上断开的线路又会恢复畅通，继续传输数据。
编辑本段工作原理生成树协议的国际标准是IEEE802.1d。运行生成树算法的网桥/交换机在规定的间隔 （默认2秒）内通过网桥协议数据单元（BPDU）的组播帧与其他交换机交换配置信息 ，其工作的过程如下：
· 通过比较网桥优先级选取根网桥（给定广播域内只有一个根网桥）。
· 其余的非根网桥只有一个通向根交换机的端口称为根端口。
· 每个网段只有一个转发端口。
· 根交换机所有的连接端口均为转发端口。
注意：生成树协议在交换机上一般是默认开启的，不经人工干预即可正常工作。但这种自动生成的方案可能导致数据传输的路径并非最优化。因此，可以通过人工设 置网桥优先级的方法影响生成树的生成结果。
编辑本段状态运行生成树协议的交换机上的端口，总是处于下面四个状态中的一个。在正常操作 期间，端口处于转发或阻塞状态。当设备识别网络拓扑结构变化时，交换机自动进 行状态转换，在这期间端口暂时处于监听和学习状态。
◆禁用：由网络管理员或者网络故障原因导致系统的端口处于Disabled状态。这个状态是比较特殊的状态，它并不是端口正常的STP状态的一部分.
◆阻塞：所有端口以阻塞状态启动以防止回路。由生成树确定哪个端口转换到转发状态，处于阻塞状态的端口不转发数据但可接受BPDU。 耗时20s.
◆监听：不转发，检测BPDU，（临时状态）。 耗时15s.
◆学习：不转发，学习MAC地址表（临时状态）。 耗时15s.
◆转发：端口能转送和接受数据。
编辑本段数据结构生成树是一个连通图G的一个极小连通子图。
包含G的所有n个顶点，但只有n-1条边，并且是连通的。
生成树可由遍历过程中所经过的边组成。
编辑本段生成树根的选举STP要构建出无环的交换网络，就必须在网络中选出一台交换机做为核心交换机，STP称其为Root，也就是根，功能相当于hub-spoke网络中的Hub。其它不是Root的交换机则需要留出一条活动链路去往根交换机，因为只要普通交换机到根是通的，到其它交换机也就是通的。
需要说明的是，只有在一个三层网络中，广播能够到达的范围内，才需要进行相同的STP计算与选举，也就是一个广播域内独立选举STP，因为网络被路由器分割成两个广播域，所以在两个网段中，需要进行独立的STP计算与选举。
STP在计算与选举时，只会留下唯一一条活动链路，将其它所有多余链路全部block，所以STP要确定两点之间是否存在多条链路，因为只有两点之间有多条链路时，才有链路需要被block。要确认两点之间网络是否通畅，只要发送数据作个测试即可得到答案，而要确认两点之间是否有多条链路，方法还是发送数据作个测试就能得到答案。当然，要测试两点之间是否有多条链路，需要发送特殊的数据来做测试，比如给数据包都做上相同的标记，然后发出去，如果交换机同时从多个接口收到相同标记的数据包，很显示，交换机与发送者之间就是存在多条链路的，因此需要靠STP计算来断开多余链路。
STP在发送数据包测试网络是否有多条链路，是靠发送bridge protocol data units (BPDUs)来完成的，同台交换机发出去的BPDU都被做上了相同的标记，只要任何交换机从多个接口收到相同标记的BPDU，就表示网络中有冗余链路，因此需要STP断开多余链路。BPDU数据包里面有以下信息：
根交换机的bridge ID。
发送交换机的bridge ID 。
到根交换机的Path Cost。 
发送接口以及优先级。
Hello、forward delay、max-age时间。
同台交换机发出的BPDU，bridge ID都是一样的，因为是用来标识自己的，其中bridge ID由两部分组成：Bridge优先级和MAC地址，默认优先级为32678。
交换机上的每个端口也是有优先级的，默认为128，范围为0-255。
注：在STP协议中，所有优先级数字越小，表示优先级越高，数字越大，优先级越低。
STP在计算网络时，需要在网络中选举出根交换机（Root），根端口（Root Port），以及指定端口(Designated Port)，才能保证网络的无环，选举规则分别如下：
根交换机（Root）
在同一个三层网络中需要选举，即一个广播域内要选举，并且一个网络中只能选举一台根交换机。Birdge-ID中优先级最高（即数字最小）的为根交换机，优先级范围为0-65535，如果优先级相同，则MAC地址越小的为根交换机。
根端口（Root Port）
所有非根交换机都要选举，非根交换机上选举的根端口就是普通交换机去往根交换机的唯一链路，选举规则为 到根交换机的Path Cost值最小的链路，如果多条链路到达根交换机的Path Cost值相同，则选举上一跳交换机Bridge-ID最小的链路，如果是经过的同一台交换机，则上一跳交换机Bridge-ID也是相同的，再选举对端端口优先级最小的链路，如果到达对端的多个端口优先级相同，最后选举交换机对端端口号码最小的链路。
指定端口(Designated Port)
在每个二层网段都要选举，也就是在每个冲突域需要选举，简单地理解为每条连接交换机的物理线路的两个端口中，有一个要被选举为指定端口，每个网段选举指定端口后，就能保证每个网段都有链路能够到达根交换机，选举规则和选举根端口一样，即：到根交换机的Path Cost值最小的链路，如果多条链路到达根交换机的Path Cost值相同，则选举上一跳交换机Bridge-ID最小的链路，如果是经过的同一台交换机，则上一跳交换机Bridge-ID也是相同的，再选举对端端口优先级最小的链路，如果到达对端的多个端口优先级相同，最后选举交换机对端端口号码最小的链路。
在STP选出根交换机，根端口以及指定端口后，其它所有端口全部被Block，为了防止环路，所以Block端口只有在根端口或指定端口失效的时候才有可能被启用。
交换机上的端口，根据端口的带宽不同，Path Cost值也不同，以下参数为标准：
10 Mb/s：100 
100 Mb/s：19 
1000 Mb/s：4 
10000 Mb/s：2 
可以看出，带宽越高，被选为根端口和指定端口的几率就越大，所以经过STP选举后，活动的链路总是性能最好的，其它被Block掉的端口，将在活动端口失效时被启用。

扩展阅读： 
1 
http://wenku.baidu.com/view/76c118d6360cba1aa811dab1.html 
开放分类： 
应用科学 电子科技 电脑术语 科学 自动化 计算机术语 网络 交换机 数据结构 STP 


我来完善 “生成树”相关词条： 

链路聚合 VTP 端口镜像 虚拟局域网 组播 虚拟路由器冗余协议 DHCP 
百度百科中的词条正文与判断内容均由用户提供，不代表百度百科立场。如果您需要解决具体问题（如法律、医学等领域），建议您咨询相关领域专业人士。
本词条对我有帮助添加到搜藏 分享到:更多
合作编辑者 
汐晨若风 ， w_ou ， catipj ， chen200763050 ， 百科ROBOT ， caucxiaom ， 五花大绑边狼 ， 人民的儿 ， 桂纬武 ， NMCZN 更多 
如果您认为本词条还需进一步完善，百科欢迎您也来参与 编辑词条 在开始编辑前，您还可以先学习如何编辑词条
如想投诉，请到百度百科投诉中心；如想提出意见、建议，请到百度百科吧。
百度百科内容方针
提倡有可靠依据、权威可信的内容鼓励客观、中立、严谨的表达观点不欢迎恶意破坏、自我或商业宣传在这里你可以
编辑
质疑
投诉
全方位的质量监督
学术委员会：为亿万网友提供权威意见质量委员会：把控质量，做更好的知识下载2频道
00

去兑换>>您尚无道具可使用
成长任务日常任务本月累计点亮0天。今日笑脸还没点亮哦。
名符图实：参加任务，拿点亮任务日历获得财富值热词推送编辑热词可获得额外经验值
词条动态进入我的百科您目前的等级是2级
您目前的经验值是214点
您还需286点经验值即可升为3级


词条统计
浏览次数：约 43206次
编辑次数：13次 历史版本
最近更新：2013-03-25
创建者：gailei1981
更多贡献光荣榜
辛勤贡献者： 
 汐晨若风   版本 

最新动态
禽流感和感冒有啥区别：

百科消息：
专题：什么人更容易感染禽流感 
玩拼图游戏，赢iPad mini啦！ 
网易云阅读APP 百万好书随心阅 
王菲新歌4月16日全球首发 
有奖调查：分享你获取知识的渠道 

© 2013 Baidu 使用百度前必读 | 百科协议 | 百度百科合作平台
生成树作用工作原理状态数据结构生成树根的选举

  参考资料 
 

×
